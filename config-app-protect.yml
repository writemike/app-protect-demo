---
- tasks:
  - name: "Ensure NGINX WAF Policy Directory Exists"
    file:
      path: "{{ nginx_main_upload_dest | default('/etc/nginx/wafpolicy') }}"
      state: directory

  - name: "Upload NGINX Updated WAF Policy Configuration File"
    copy:
      src: "{{ nginx_main_upload_src | default('dvwa-policy-v1.json') }}"
      dest: "{{ nginx_main_upload_dest | default('/etc/nginx/wafpolicy') }}"
      backup: yes
    notify: "Reload NGINX"

  - name: "Reload NGINX"
    command: "nginx -s reload"
    changed_when: false
